---
title: "Time Series"
author: "Gaurika_Tyagi"
date: "June 4, 2016"
output: html_document
---

##Reading Data

The scan() function assumes that the data for successive time
points is in a simple text file with one column. The kings dataset contains data on the age of death of successive kings of England. It ha 42 observations.

```{r}
kings_death <- scan("http://robjhyndman.com/tsdldata/misc/kings.dat",skip=3)
head(kings_death)

births <- scan("http://robjhyndman.com/tsdldata/data/nybirths.dat")

souvenir <- scan("http://robjhyndman.com/tsdldata/data/fancy.dat")
```

##Converting data to time-series object

Time series analysis requires that the dataset is convrted to a time-series object before the analysis. By default ts() assumes that the data has been collected on an yearly basis. If the data has been collected on a monthly basis, we can set the frequency=12, for quarterly we set the frequency=4.

```{r}
death_timeseries <- ts(kings_death)
death_timeseries

births_timeseries <- ts(births, frequency=12, start=c(1946,1))
births_timeseries

#data is gathered monthly from January, 1987
souvenir_timeseries <- ts(souvenir, frequency=12, start=c(1987,1))
souvenir_timeseries
```

##Plotting time-series data

```{r}
par(mfrow = c(1,3))
plot.ts(death_timeseries)
plot.ts(births_timeseries)
plot.ts(souvenir_timeseries)
```

Time-series interpretation:
1. Kings' death data shows random fluctuations in the data that are roughly constant in size over time. Hence, this must be an additive model
2. Babies' birth times show seasonality, with peaks durng summers and troughs during winters
3. Souvenir data shows that the size of the seasonal fluctuations increase with time. Clearly his data is not an example of an additive model and will need to be transformed to obtain an additive model.

```{r}
log_souvenir_ts <- log(souvenir_timeseries)
plot.ts(log_souvenir_ts)
```

Now, the size of the seasonal fluctuations and random fluctuations in the log-transformed time series seem to be roughly constant over time, and do not depend on the level of the time series.

##Decomposing Time-Series Data

separating it into its constituent components

__Decomposing Non-Seasonal Data__

Decomposing Non-Seasonal time-series data comprizes of breaking down the non-seasonal data into a trend and an irregular component.

To estimate the trend component of a non-seasonal time series that can be described using an additive model, it is
common to use a smoothing method, such as calculating the simple moving average of the time series.

The order/n of SMA is found out by exploratory analysis. The kings' death data appears non-seasonal and maybe additive. Let us start with analyzing that.

```{r}
#install.packages("TTR")
library(TTR)

kings_ts_SMA2 <- SMA(death_timeseries, n = 2)
plot.ts(kings_ts_SMA2)
#still there is a lot of random fluctuations in the time series smoothed using a simple moving average of order 2. Now, we try a higher order

kings_ts_SMA7 <- SMA(death_timeseries, n = 7)
plot.ts(kings_ts_SMA7)
```

The order 7 gives a clearer picture of the trend component, and we can see that the age of death of the kings decreased from over 50 years old to lesser than 40 years old during the reign of the first 20 kings, and then increased after that to about 73 years old by the end of the reign of the 40th king in the time series

__Decomposing Seasonal Data__

A seasonal time series consists of a trend component, a seasonal component and an irregular component. Decomposing such a data breaks it down into these three components.

The trend component that can be described using an additive model can be found out using the decompose(). It returns a list object with named elements, “seasonal”, “trend”, and “random”

The births dataset above showed seasonality of summer and winter. Let us see if it can be decomposed as an additive model of the three omponents as random fluctutations seemed constant over time.

```{r}
births_ts_components <- decompose(births_timeseries)
births_ts_components

#This shows the original values along with seasonal, random and trend components. It also shows that the seasonality appears to be additive.
```

Shows that the seasonal factor is the lowest for Feb and highest for July, indicating the highest births in July and lowest in February. 

This also shows that the seasonal factors remain more or less the same for every year (for respective months from /Jan-Dec).

```{r}
plot(births_ts_components)
```

The trend component shows a steady increase in birth rates since 1949.

Such an additiv seasonal model can be adjusted in time-series respect by estimating the seasonal component and subtracting it from the original data. This will give the main trend and the irregular component.

```{r}
births_ts_seasonally_adjusted <- births_timeseries - births_ts_components$seasonal
plot(births_ts_seasonally_adjusted)
```

